<link rel="stylesheet" href="/components/pagesStyle/dashboard.css" />

<link rel="stylesheet" href="/components/dialogs/css/dialog.css" />
<!-- <link rel="stylesheet" href="/components/dialogs/css/dialog-alex.css" /> -->
<link rel="stylesheet" href="/components/dialogs/css/dialog-sandra.css" />

<script src="/components/dialogs/js/modernizr.custom.js"></script>
<script src="/components/dialogs/js/classie.js"></script>
<script src="/components/dialogs/js/dialogFx.js"></script>


<super-navbar>
<super-navbar-title>
<i class="icon ion-ios-cloud-outline"></i>你好雨蒙
</super-navbar-title>

<super-navbar-button side="right"> <i class="icon ion-ios-cloud-outline"></i></super-navbar-button>
</super-navbar>

<div class="container" ng-controller="DashboardController">
  <div>
    <div class="left dashboard-famliy-icon" id="dashboard-family" ng-click="goToFamily()">
      <i class="icon ion-ios-people">&nbsp;&nbsp;&nbsp;</i> 
    </div>
    
    <div class="right" id="dashboard-recommend" ng-click="goToRecomment()">
      <img ng-src="/components/pagesStyle/img/forks.svg" />
    </div>
  </div>

  <div class="clearfix"></div>
  <br>
  
  <div class="dashboard-avatar-img">
    <img ng-src="/components/pagesStyle/img/test.svg" />
  </div>

  <div class="margin-top-30"></div>
  <div class="dashboard-middle-selector">
    <span><img ng-src="/components/pagesStyle/img/charts.svg" /></span>
    <span ng-click="openIceBox()"><img ng-src="/components/pagesStyle/img/icebox.svg" /></span>
    <span><img ng-src="/components/pagesStyle/img/cart.svg" /></span>
  </div>

  <!-- <button class="button" data-dialog="somedialog" class="trigger">我买xx</button> -->
  <div class="shop-box">
    <div class="swipegory">
      <nav>
        <ul>
          <li><a href="#item1">###蔬菜####</a></li>
          <li><a href="#item2">水果#######</a></li>
          <li><a href="#item3">肉类</a></li>
          <li><a href="#item4">饮料</a></li>

        </ul>
      </nav>

      <ul class="panes">

        <div class="dashboard-avatar-img">
          <img ng-src="/components/pagesStyle/img/test.svg" />
        </div>
        <li style="height:200px;"></li>
        <li style="height:200px;"></li>
        <li style="height:200px;"></li>
        <li style="height:200px;"></li>
        
      </ul>
    </div>

  </div>

  <div id="mailMan"></div>
</div><!-- /container -->


<script>
  // (function() {

  //   var dlgtrigger = document.querySelector( '[data-dialog]' );
  //   // var dlgtrigger = document.getElementById("fuckme");
  //   var somedialog = document.getElementById( dlgtrigger.getAttribute( 'data-dialog' ) );
  //   var dlg = new DialogFx( somedialog );
  //   dlgtrigger.addEventListener( 'click', dlg.toggle.bind(dlg) );

  // })();

//swipers :js, for me it's durty code
var autoAdjustHeight = false;
$('nav a').on('mousedown', function(e){
  e.preventDefault();
  var goTo = $(this).parent().index();  
  swipegoryUpdate(goTo);
});

$("ul.panes").swipe({
  swipeStatus:function(event, phase, direction, distance, duration, fingerCount) {    
    var translateString = 'translate3d(0px, 0px, 0px)';
    var transitionDuration = $('nav li.cur').css('transitionDuration');
    var speed = transitionDuration;    
    
    if(phase == 'move') {
      speed = '0ms';      
      if(direction == 'left') {
        translateString = 'translate3d(-' + distance + 'px, 0px, 0px)';
        $('.panes li.cur').css('marginLeft', '-'+ distance +'px');
      }
      else if(direction == 'right') {
        translateString = 'translate3d(' + distance + 'px, 0px, 0px)';
        $('.panes li.cur').css('marginLeft', distance +'px');
      }
      $('nav li.cur').css({ 
        transitionDuration: speed,
        transform: translateString
      });
      
    }
    else if (phase == 'end') {
      // reset transform3D    
      var marginLeft = $('nav li.cur').css('marginLeft');
      $('nav li.cur').attr('style', '').css('marginLeft', marginLeft);
      $('.panes li.cur').attr('style', '');
    }
  },
  swipeLeft:function(event, direction, distance, duration, fingerCount) {
    //This only fires when the user swipes left
    var goTo = $('nav li.cur').index();
    goTo++;
    swipegoryUpdate(goTo); 
    console.log("swipeLeft: ", goTo);
    $("#mailMan").trigger("dashboard:swiper:goto", goTo)
  },
  swipeRight:function(event, direction, distance, duration, fingerCount) {
    //This only fires when the user swipes left
    var goTo = $('nav li.cur').index();
    goTo--;
    swipegoryUpdate(goTo); 
    console.log("swipeRight: ", goTo);
    $("#mailMan").trigger("dashboard:swiper:goto", [goTo])
  
  },
  threshold: 50,
  triggerOnTouchEnd: false,
  allowPageScroll: "vertical",
  excludedElements: "button, input, select, textarea, .noSwipe"
});


$(window).load(function() {
  swipegoryUpdate(0);
});

function swipegoryUpdate(goTo) {
  var listItems = $('nav li');
  var panes = $('.panes');
  var prev = goTo - 1;
  var next = goTo + 1;  
  if(goTo >= 0 && goTo < listItems.length) {   
    listItems.removeClass('prev').removeClass('cur').removeClass('next').removeClass('before').removeClass('after');
    $('li', panes).removeClass('prev').removeClass('cur').removeClass('next').removeClass('before').removeClass('after');

    listItems.each(function(i) {
      var li = $(this);
      var pane = $('li:eq('+i+')', panes);
      
      li.attr('style', '');

      if(i == prev) {
        li.addClass('prev');
        li.css('margin-left', '0');      
        pane.addClass('prev');
      }
      else if(i == next) {
        li.addClass('next');
        li.css('margin-left', '-' + li.outerWidth() + 'px');
        pane.addClass('next');
      }
      else if(i < goTo) {
        li.addClass('before');
        li.css('margin-left', '-' + li.outerWidth() + 'px');
        pane.addClass('before');
      }
      else if(i == goTo) {
        li.addClass('cur');
        var marginLeft = li.outerWidth() / 2;
        
        li.css('margin-left', '-' + marginLeft + 'px');
        pane.addClass('cur');

        if(autoAdjustHeight == true) {
          $('.swipegory').css('height', pane.outerHeight() + li.outerHeight());
        }

      }
      else if(i > goTo) {
        li.addClass('after');
        li.css('margin-left', '0');
        pane.addClass('after');
      }
    });    
}
}


</script>

